<section>
  <header class="bg-slate-100 flex justify-between items-center p-2">
    <div class="flex gap-2 items-center montserrat-bold">
      <i class="pi pi-times" routerLink="/"></i>
      <span class="text-base">Create Post</span>
    </div>
    <p-speedDial
      [model]="actionItems"
      direction="down"
      class="post-action-dial"
      buttonClassName="p-button-info w-8 h-8"
      maskClassName=""
      class="post-action-dial"
    />
  </header>
  <p-editor styleClass="post-editor" [formControl]="editorControl" #postEditor>
    <ng-template pTemplate="header">
      <span class="ql-formats">
        <select class="ql-size">
          <option value="small"></option>
          <!-- Note a missing, thus falsy value, is used to reset to default -->
          <option selected></option>
          <option value="large"></option>
          <option value="huge"></option>
        </select>
        <select class="ql-font ql-picker"></select>
      </span>
      <span class="ql-formats">
        <button type="button" class="ql-bold" aria-label="Bold"></button>
        <button type="button" class="ql-italic" aria-label="Italic"></button>
        <button
          type="button"
          class="ql-underline"
          aria-label="Underline"
        ></button>
        <button type="button" class="ql-strike" aria-label="strike"></button>
      </span>
      <span class="ql-formats">
        <select class="ql-color"></select>
        <select class="ql-background"></select>
      </span>
      <span class="ql-formats">
        <button type="button" class="ql-list" value="ordered"></button>
        <button class="ql-list" value="bullet" type="button"></button>
        <select class="ql-align"></select>
      </span>
      <span class="ql-formats custom-formats">
        <p-fileUpload
          mode="basic"
          name="files"
          chooseIcon="pi pi-image"
          [url]="imageApiUrl"
          accept="image/*"
          maxFileSize="2097152"
          [auto]="true"
          [multiple]="false"
          chooseLabel=""
          class="inline-block relative top-1 custom-image-upload"
          styleClass="bg-green-100 text-green-900 p-1"
          [style]="{
            border: '0'
          }"
          (onBeforeUpload)="isLoading.set(true)"
          (onError)="handleImageError($event)"
          (onUpload)="handleImageUpload($event)"
        />
        <span
          class="pi pi-link bg-purple-100 text-purple-900 px-2.5 py-2 ml-2 rounded"
          (click)="openLinkOverlay(op, $event)"
        ></span>
      </span> </ng-template
  ></p-editor>

  @if (isLoading()) {
    <div
      class="absolute top-0 left-0 w-screen h-screen flex items-center justify-center backdrop-opacity-10 backdrop-invert bg-white/30"
    >
      <p-progressSpinner ariaLabel="loading" />
    </div>
  }

  <p-toast position="bottom-center" />
</section>

<p-overlayPanel #op>
  <div>
    <div class="flex flex-col items-end gap-4">
      <p-inputGroup>
        <p-inputGroupAddon>
          <i class="pi pi-link"></i>
        </p-inputGroupAddon>
        <input
          pInputText
          placeholder="type or paste the link here"
          class="lato-regular text-base"
          #linkInput
        />
      </p-inputGroup>
      <button
        pButton
        pRipple
        label="Add"
        class="lato-bold py-1 px-5"
        (click)="onAddLink(linkInput, op)"
        [disabled]="!linkInput.value"
      ></button>
    </div>
  </div>
</p-overlayPanel>
